# Morp

## 概要
Pythonだけで動く単語分割器です。
点予測とよばれる、文字境界を単語境界として分割できるかを独立に推定しています。
そのため、部分的にアノテーションされたコーパスを学習することができます。
これは、分野適応において有効であると考えられています。
点予測による形態素解析としては、[KyTea](http://www.phontron.com/kytea/index-ja.html)がありますが、Pythonで自然言語処理をやる人向けにもっと手軽に利用できたらということで作りました。KyTeaと異なり、品詞の推定は行いません。

### リポジトリ構成
```
Morp/      ... ライブラリ本体
  ├─ __init__.py
  └─ morp.py        ... 形態素解析クラス
sample.py ... 動作例スクリプト
sample.txt, sample2.txt ... 学習用サンプルデータ
setup.py  ... pip インストール用設定
README.md ... このファイル
```

### Morp クラスの概要
`Morp/morp.py` に定義されている `Morp` クラスが学習と単語分割のロジックを担います。

- `train()` で学習を行い、`word_segment()` で文字列を単語分割します。
- 文字 N-gram や文字種、辞書マッチに基づく特徴量を生成し、scikit-learn の分類器で境界判定を行います。
- `|` と `-` を混在させた部分的アノテーションにも対応しています。

### 重要事項
- **Python バージョン**: 動作確認は Python 3.4.3 で行われています。
- **依存ライブラリ**: `numpy`、`scikit-learn`、`scipy` を利用します。
- **学習データ形式**: スペース区切りの完全アノテーション、または `|` / `-` を用いた部分アノテーションの 2 形式を扱えます。
- **コードの注意点**: `morp.py` には処理が重い箇所やメモリ使用に関する注記があります。

### 次に学ぶと良いこと
1. `sample.py` を実行して学習〜推論の流れを確認する。
2. `Morp` クラス各メソッドの詳細を読み、素性の割り当てを理解する。
3. `setup.py` を使ったパッケージ化を試してみる。
4. テストコードを追加し、改修の安全性を高める。

## インストール

Python3.4.3で動作確認をしています。
```
pip install git+https://github.com/ushiku/morp.git
```
ライブラリとして、numpyとscikit-learn, scipyが必要です.


## 使い方
```
word_dict = {'ドイツ人':1}
Analyser = Morp(word_dict)
```
インスタンス生成時に、word_dictを指定できます。 word_dictはなくても動作します。

```
Analyser.train(['sample.txt', 'sample2.txt'])  # テキストファイルから学習
```
trainで、単語境界を学習できます。
テキストファイルの形式は
```
私 は お金　が 好き です
私|は|お-金|が|好-き|で-す　　
```
のいづれかの書き方です。
前者はword_boundaryをスペースで、後者はword_boundaryがあるところを|、ないところを-で表示しています。後者は、後述の部分的アノテーションに対応しています。
行ごとには混在していても大丈夫ですが、同一行に二つの表記が混じるとエラーを吐きます。

```
print(Analyser.word_segment('私は元気です'))
>>> 私 は 元気 です
```
学習後に、word_segmentの引数に文字列を渡すと、単語分割された文字列を出力します。

## 素性について
KyTeaと同じ素性を使っています。
すなわち、とある文字境界について、左側1, 2, 3文字と右側1, 2, 3文字.それぞれの文字種(ひらがな、カタカナ、漢字、数字、その他).単語辞書に乗っている単語が、境界の直前で終わるか(f),境界の直後から始まるか(s),
境界をまたいでいるか(o)のbinary。また、上記の文字、文字種にたいしてbigram, trigramを見ています。

##部分的アノテーションについて
特定の分野の解析制度をあげたい時は、部分的アノテーションをすることで効率的に精度があげられると考えられます。 
```
私は|金-色-夜-叉|が好きです
```
このように部分的に、金色夜叉のみをアノテーションします。
